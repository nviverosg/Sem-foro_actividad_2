# Sem-foro_actividad_2
# Modificación y respaldo código inicial: 25-08-2020
/*
SEMAFORO DE DOS SENTIDOS, 3 SEMAFOROS PARA AUTOMOVILES Y PEATONES.
EL CODIGO QUE SE PLANTEA, CONSISTE EN UNA ESQUINA LA CUAL CONSISTE EN DOS
SENTIDOS PARA TRANSITAR. ESTA ESQUINA POSEE 3 SEMAFOROS PARA PEATONES Y AUTOMOVILES
EN DONDE EL SENTIDO QUE POSEE 2 SEMAFOROS (SEMAFORO2 Y SEMAFORO3), TIENE UNA DURACION 
DE 2 MINUTOS, EL CUAL SE PUEDE ADELANTAR APRETANDO EL BOTON PARA PEATONES, ESTE SOLO 
FUNCIONARA MIENTRAS AL SEMAFORO NO LE QUEDE 10 SEGUNDOS O MENOS, DE SER ASI EL SEMAFORO 
TERMINARA EL TIEMPO RESTANTE. UNA VEZ PASEN LOS 2 MINUTOS O SE PRESIONE EL BOTON, SE 
ENCIENDE EL SEMAFORO (SEMAFORO1) CORRESPONDIENTE AL OTRO SENTIDO DE LA CALLE. EL SEMAFORO1
TIENE UNA DURACION DE 1 MINUTO Y TIENE LA MISMA MISMA CONDICION QUE LOS OTROS SEMAFOROS CON
RESPECTO AL FUNCIONAMIENTO DEL BOTON.
CIRCUITO:
	- 6 LED ROJOS.
	- 6 LED VERDES.
    - 6 LED AMARILLOS.
    - 16 RESISTENCIAS DE 220 Ohm.
    - 3 RESISTENCIAS DE 1 kOhm.
    - 3 BOTONERAS.
    - 1 PIEZO ELECTRICO.
*/
//CODIGO 
unsigned long tiempo1 = 0; //VARIABLE DE TIEMPO.
unsigned long tiempo2 = 0; //VARIABLE DE TIEMPO.
int contador = 0; //CONTADOR DE ITERACIONES PARA EL SEMAFORO2 Y SEMAFORO3 SENTIDO HORIZONAL.
int contador2 = 0; //CONTADOR DE ITERACIONES PARA SEMAFORO1 SENTIDO VERTICAL.
void setup()
{
  pinMode(A1, OUTPUT); //LED VERDE, SEMAFORO1 SENTIDO VERTICAL.
  pinMode(3, OUTPUT); //LED AMARILLO, SEMAFORO1 SENTIDO VERTICAL.
  pinMode(4, OUTPUT); //LED ROJO, SEMAFORO1 SENTIDO VERTICAL
  pinMode(5, OUTPUT); //LED ROJO, SEMAFOROPEATONAL1 SENTIDO VERTICAL.
  pinMode(6, OUTPUT); //LED VERDE, SEMAFOROPEATONAL1 SENTIDO VERTICAL.
  pinMode(7, INPUT); // ENTRADA BOTONERA PASO PEATONAL SEMAFORO1 SENTIDO VERTICAL.
  pinMode(8, INPUT); //ENTRADA BOTONERAS PASOS PEATONALES SEMAFORO2 Y SEMAFORO3 SENTIDO HORIZONTAL.
  pinMode(9, OUTPUT); //LED VERDE PARA SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3 SENTIDO HORIZONTAL.
  pinMode(10, OUTPUT); //LED ROJO PARA SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3 SENTIDO HORIZONTAL.
  pinMode(11, OUTPUT); //LED VERDE PARA SEMAFORO2 Y SEMAFORO3 SENTIDO HORIZONTAL.
  pinMode(12, OUTPUT); //LED AMARILLO PARA SEMAFORO2 Y SEMAFORO3 SENTIDO HORIZONTAL.
  pinMode(13, OUTPUT); //LED ROJO PARA SEMAFORO2 Y SEMAFORO3 SENTIDO HORIZONTAL.
  pinMode(A0, OUTPUT); //TIMBRE PARA SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3 SENTIDO HORIZONTAL.
  Serial.begin(9600); 
  tiempo1 = millis() ;//VARIABLE ENCARGADA DE CONTAR EL TIEMPO QUE EL ARDUINO SE ENCUENTRA PRENDIDO.
}

void loop()
{
  tiempo2 = millis();
  tiempo1= millis();
  if (tiempo2 < (tiempo1+1000))
  {
    tiempo1= millis();
  	while (digitalRead(8)){ //INICIA EL CICLO, DEFINIENDO QUE EL BOTON DEL SENTIDO HOR. NO ESTA PRESIONADO.
      digitalWrite(13, LOW);//APAGA LED ROJO SEMAFORO2 Y SEMAFORO3
      digitalWrite(12, LOW);//APAGA LED AMARILLO SEMAFORO2 Y SEMAFORO3
      digitalWrite(11, HIGH);//PRENDE LED VERDE SEMAFORO2 Y SEMAFORO3
      digitalWrite(10, HIGH);//PRENDE LED ROJO SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3
      digitalWrite(9, LOW);//APAGA LED VERDE SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3
      tiempo1=millis();//ACTUALIZA EL VALOR DEL TIEMPO1
      digitalWrite(6, HIGH);//PRENDE LED VERDE SEMAFOROPEATONAL1
      digitalWrite(5, LOW);//APAGA LED ROJO SEMAFOROPEATONAL1
      digitalWrite(4, HIGH);//PRENDE LED ROJO SEMAFORO1
      digitalWrite(3, LOW);//APAGA LED AMARILLO SEMAFORO1
      digitalWrite(A1, LOW);//APAGA LED VERDE SEMAFORO1
      noTone(A0);//NO SUENA EL PITO DEL SEMAFORO.
      while (contador<110){ //CONTADOR DE SEGUNDOS DEL SEMAFORO "DELAY" CON CICLO WHILE, ANTES DE LOS 110 SEGUNDOS.
        delay(250); //EL DELAY SE DEFINE EL BREVE LAPSO PARA QUE EL CODIGO NO QUEDE ATRAPADO EN ESTE.
        contador=contador+(1);
        if (digitalRead(8)==LOW){ //REVISA SI EL BOTON DEL SEMAFORO2 Y SEMAFORO3 NO HA SIDO PRESIONADO.
          tiempo1=millis(); //ACTUALIZA EL CONTADOR DE SEGUNDOS CON EL ARDUINO ENCENDIDO.
          break; //SI EL BOTON FUE PRESIONADO ANTES DE LOS 110 SEGUNDOS, EL SEMAFORO2 Y SEMAFORO3 CAMBIARAN.
        }
        delay(250); //SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO2 Y SEMAFORO3 EN VERDE
        contador=contador+(1); //CONTADOR DE SEGUNDOS.
        delay(250); //SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO2 Y SEMAFORO3 EN VERDE
        contador=contador+(1);
        if (digitalRead(8)==LOW){ //REVISA SI EL BOTON DEL SEMAFORO2 Y SEMAFORO3 NO HA SIDO PRESIONADO.
          tiempo1=millis();  //ACTUALIZA EL CONTADOR DE SEGUNDOS CON EL ARDUINO ENCENDIDO.
          break; //SI EL BOTON FUE PRESIONADO ANTES DE LOS 110 SEGUNDOS, EL SEMAFORO2 Y SEMAFORO3 CAMBIARAN.
        }
        delay(250);//SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO2 Y SEMAFORO3 EN VERDE
        contador=contador-(2);//CONTADOR DE SEGUNDOS.
      } //SEMAFORO UN SENTIDO APAGADO.
      if (contador==110){ //SI EL BOTON NO FUE PRESIONADO EN NINGUN MOMENTO Y ES PRESIONADO DESPUES DE LOS 110 SEGUNDOS NO CAMBIARA 
        delay(10000); //DEBIDO A ESTE IF QUE ES EL ENCARGADO DE CONDICIONAR QUE EL SEMAFORO TERMINE SUS 10 SEGUNDOS RESTANTES.
      }
      digitalWrite(11, LOW);//APAGA LED VERDE SEMAFORO2 Y SEMAFORO3
      digitalWrite(12, HIGH);//PRENDE LED AMARILLO SEMAFORO2 Y SEMAFORO3
      digitalWrite(3, HIGH);//PRENDE LED AMARILLO SEMAFORO1.
      digitalWrite(4,LOW);//APAGA LED ROJO SEMAFORO1.
      delay(3000); // 3 SEGUNDOS DE DURACION PARA EL COLOR AMARILLO.
      digitalWrite(9, HIGH);//PRENDE LED VERDE SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3
      digitalWrite(10, LOW);//APAGA LED ROJO SEMAFOROPEATONAL2 Y SEMAFOROPEATONAL3
      digitalWrite(12, LOW);//APAGA LED AMARILLO SEMAFORO2 Y SEMAFORO3
      digitalWrite(13, HIGH);//PRENDE LED ROJO SEMAFORO2 Y SEMAFORO3
      digitalWrite(5, HIGH);//PRENDE LED ROJO SEMAFOROPEATONAL1
      digitalWrite(6, LOW);//APAGA LED VERDE SEMAFOROPEATONAL1
      digitalWrite(A1, HIGH);//PRENDE LED VERDE SEMAFORO1
      digitalWrite(3, LOW);//APAGA LED AMARILLO SEMAFORO1
      tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
      while (contador2<50){ //CUENTA LOS SEGUNDOS TRANSITADOS EN EL SEMAFORO1
        delay(250); //ENTRA EL DELAY EN EL SISTEMA.
        tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
        contador2=contador2+(1); //CONTADOR DE SEGUNDOS.
        if (digitalRead(7)==LOW){ //REVISA SI EL BOTON DEL SEMAFORO1 NO HA SIDO PRESIONADO.
          tiempo1=millis(); //ACTUALIZA EL CONTADOR DE SEGUNDOS CON EL ARDUINO ENCENDIDO.
          break;//SI EL BOTON FUE PRESIONADO ANTES DE LOS 50 SEGUNDOS, EL SEMAFORO1 CAMBIARA.
        }
        tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(250);//SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO1
        contador2=contador2+(1);//CONTADOR DE SEGUNDOS.
        delay(250);//SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO1
        contador2=contador2+(1);//CONTADOR DE SEGUNDOS.
        if (digitalRead(7)==LOW){//REVISA SI EL BOTON DEL SEMAFORO1 NO HA SIDO PRESIONADO.
          tiempo1=millis();//ACTUALIZA EL CONTADOR DE SEGUNDOS CON EL ARDUINO ENCENDIDO.
          break;//SI EL BOTON FUE PRESIONADO ANTES DE LOS 50 SEGUNDOS, EL SEMAFORO1 CAMBIARA.
        }
        tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(250);//SI NO FUE PRESIONADO, SIGUE ENCENDIDO EL SEMAFORO1
        contador2=contador2-(2);//CONTADOR DE SEGUNDOS.
      }
      tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
      if (contador2==50){//SI EL BOTON NO FUE PRESIONADO EN NINGUN MOMENTO Y ES PRESIONADO DESPUES DE LOS 50 SEGUNDOS NO CAMBIARA
        tone( A0, 523, 150);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(2500);
        tone( A0, 523, 400);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(2500); //DEBIDO A ESTE IF QUE ES EL ENCARGADO DE CONDICIONAR QUE EL SEMAFORO TERMINE SUS 10 SEGUNDOS RESTANTES.
        tone( A0, 523, 400);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(2500);
        tone( A0, 523, 400);//SONIDO DEL TIMBRE PARA CRUZAR
        delay(2500);
      }
      int contador = 0;//SE REINICIAN LOS CONTADORES DE SEGUNDOS ANTES DE QUE EL 
      int contado2 = 0;//SISTEMA DE INICIO NUEVAMENTE AL CICLO.
      noTone(A0);
      digitalWrite(A1, LOW);//APAGA LED VERDE SEMAFORO1     
      digitalWrite(12, HIGH);//PRENDE LED AMARILLO SEMAFORO2 Y SEMAFORO3
      digitalWrite(3, HIGH);//PRENDE LED AMARILLO SEMAFORO1
      digitalWrite(13, LOW);//APAGA LED ROJO SEMAFORO2 Y SEMAFORO3
      delay(3000);//EL SISTEMA QUEDA 3SEGUNDOS CON LA LUZ AMARILLA DE FORMA DE SEGURIDAD.
      }
   }
}